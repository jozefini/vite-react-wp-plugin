// Filesystem.
const fs = require('fs');
const path = require('path');

// Manifest file.
const manifest = require('../build/manifest.json');

const getFileArgs = (fileName) => {
	const manifestFile = manifest?.[fileName]?.['file'];
	if (!manifestFile) {
		return `[]`;
	}

	return `[
		'file'    => '${manifestFile}',
		'version' => '${manifestFile.split('-').pop().split('.')[0]}',
	]`;
};

// Generate the version.php file
const phpFileContent = `<?php

// Auto-generated by build process. Do not edit.

return [
	'react-app-js'  => ${getFileArgs('index.html')},
	'react-app-css' => ${getFileArgs('index.css')},
	'front-js'      => ${getFileArgs('scripts/front.js')},
];
`;

// Write the file.
fs.writeFileSync(
	path.join(__dirname, '../build', 'manifest.php'),
	phpFileContent
);
